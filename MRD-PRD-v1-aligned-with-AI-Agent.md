# 对齐后的MRD + PRD（V1 对齐草案）

> 项目：3D 霍尔传感器市场赋能与情报平台  
> 版本：V1.0（对齐稿）  
> 目标：收敛 MRD↔PRD 的指标、范围、验收口径，确保 MVP 能闭环验证“Design‑in 增长”假设

---

## 目录
- [一、MRD（市场需求文档，Aligned）](#mrd)
  - 1. 背景与问题定义
  - 2. 目标客户与使用场景
  - 3. 价值主张与北极星指标
  - 4. MVP 范围（V1）与不做清单
  - 5. 商业假设与验证计划（A/B）
  - 6. 竞争与替代品
  - 7. 风险与对策
  - 8. 里程碑与资源评估
- [二、PRD（产品需求文档，Aligned）](#prd)
  - A. 产品概述与用户故事
  - B. 功能需求（V1）
  - C. 数据模型与“Design‑in”口径
  - D. 指标与仪表盘（可观测化）
  - E. 集成策略（MVP 收敛）
  - F. 非功能需求（SLA/安全/运维）
  - G. 埋点与事件
  - H. 交付物与验收标准
  - I. 推广与运营计划
  - J. V2 展望与进入门槛
- [附录：模板与枚举](#appendix)

---

<a id="mrd"></a>
# 一、MRD（市场需求文档，Aligned）

## 1. 背景与问题定义
- **行业背景**：3D 霍尔传感器广泛用于摇杆、鼠标滚轮、踏板、方向盘/换挡、座椅调节、线控手柄、无刷电机位置等。项目型销售（Design‑in）周期长、跨角色协作密集（销售/FAE/应用/客户工程/质量）。
- **核心痛点**：
  1) 方案复用率低：典型应用与磁路配置分散在私有文档与个人经验中，重复答疑、复盘沉没；
  2) 响应链条长：客户问题→销售→FAE→应用→研发的多跳传递导致响应延迟、上下文丢失；
  3) 数据不可用：Design‑in 定义不统一、阶段无口径、统计不可复现，管理层无法做因果归因；
  4) 情报滞后：竞品参数、价格与案例零散，缺少结构化字段与更新机制。

## 2. 目标客户与使用场景
- **角色**：销售、FAE/应用工程师、产品经理、研发/质量、渠道伙伴；
- **高频场景**：
  - S1：客户提问→工单→同类案例/参考设计一键联想→建议配置与风险提示；
  - S2：FAE 现场调试→手册式“设计检查清单”勾选→导出报告→回填工单/知识库；
  - S3：周会看板：Design‑in 活跃度、转化漏斗、响应时效、问题 TopN；
  - S4：按应用领域（如摇杆/滚轮）检索磁路/固件参考配置并二次编辑；
  - S5（管理层）：按地区/客户/产品系的 Design‑in 趋势与成败复盘。

## 3. 价值主张与北极星指标
- **价值主张**：以“可复用的参考设计+可执行的检查清单+可闭环的工单→知识”打通市场一线与中台知识沉淀，用数据化定义 Design‑in，缩短响应时间并提升首成率。
- **北极星指标（NSM）**：**月度活跃 Design‑in 项目数（MA‑DI）**。
  - 定义：当月处于以下阶段之一且有**有效活动**（见 PRD 数据模型）记录的项目：Discovery/Engage/Sample/EVT/DVT/PVT/MP（排除 Lost/On‑hold）。
  - 驱动指标（示例）：
    - I1：客户问题平均首响时长（h）
    - I2：工单→知识转化率（%）与首发通过率（%）
    - I3：设计检查清单“完成并通过”次数/项目（次）
    - I4：参考设计被复用次数（次/月）

## 4. MVP 范围（V1）与不做清单
- **V1 必做**：
  1) **工单系统（最小化）**：问题→分派→处理→总结→一键转知识；
  2) **知识库**：强模板+评审门槛（FMEA/适用范围/实验数据/脚本/失败模式）；
  3) **设计检查清单**（按应用域）：磁路/布局/接口/环境/诊断；导出 PDF 报告；
  4) **参考设计库**：可复用的磁路与固件配置卡片，附 BOM/参数/风险点；
  5) **基础看板**：NSM 与 4 个驱动指标、TopN 问题/应用、地区/客户分布；
  6) **企业微信通知**（消息卡片）；
  7) **CRM 只读同步**（账户/商机/项目映射）。
- **V1 不做**：在线磁场仿真、JIRA/ERP 深度双向、复杂流程编排、K8s 上线（保留 Docker Compose 单机）。

## 5. 商业假设与验证计划（A/B）
- **假设 H1**：首响时长每降低 20%，当月 MA‑DI 增长 ≥10%。
- **假设 H2**：参考设计复用≥30 次/月，工单平均解决时长下降 ≥15%。
- **试点**：选择 2 条销售线（各含 ≥1 销售 + 2 FAE），对比基线月。
- **周期**：试点 8 周；第 2/4/8 周复盘。
- **统计口径**：详见 PRD“指标与仪表盘”。

## 6. 竞争与替代品
- 竞争：传统知识库（Wiki/网盘）、泛用工单/CRM、个人经验驱动。
- 差异化：行业化模板、Design‑in 数据口径、参考设计/检查清单深度。

## 7. 风险与对策
- R1 采纳不足 → **运营**：上线培训+周榜激励；管理看板挂 KPI；
- R2 知识质量参差 → **流程**：强模板+评审 Gate+季度复审；
- R3 集成阻塞 → **范围**：MVP 仅做企业微信通知+CRM 只读；
- R4 数据口径不一致 → **治理**：冻结数据词典与枚举（附录），统一建模。

## 8. 里程碑与资源评估
- M1 词典冻结 & PRD 更新（1 周）；
- M2 V1 原型/评审（2 周）；M3 开发/联调（4 周）；M4 试点上线（2 周）；
- 资源：后端×2、前端×2、全栈×1、产品×1、QA×1、数据×1、FAE/销售共创×若干。

---

<a id="prd"></a>
# 二、PRD（产品需求文档，Aligned）

## A. 产品概述与用户故事
- **目标**：让一线问题快速闭环、经验高质量沉淀、Design‑in 过程可观测。
- **主要用户故事**（节选）：
  - US‑01（销售）：我把客户问题录为工单，系统自动联想相似案例与参考设计；
  - US‑02（FAE）：我在现场按“设计检查清单”逐项勾选，导出 PDF 报告并回填工单；
  - US‑03（应用/研发）：我将解决记录一键转知识（强模板），提交评审；
  - US‑04（管理）：我在看板看到本周 MA‑DI、漏斗、首响时长、TopN 问题与高风险项目。

## B. 功能需求（V1）
### B1. 工单（最小闭环）
- 流程：创建→分派→处理→总结→转知识/关闭；
- 字段：标题、客户/账号、应用域、产品系列、问题类型、严重度、环境、附件、关联项目；
- 联想：按关键词+结构化字段检索相似知识/参考设计卡片；
- 通知：企业微信消息卡片（创建/分派/催办/关闭）。

### B2. 知识库（强模板 + 评审）
- 模板必填：问题现象、根因分析、实验条件与数据、修复/参数建议、适用范围与限制、失败模式（FMEA 摘要）、脚本/参考代码、版本与时间戳、标签、作者/评审/发布人；
- 质量门槛：首发评审通过率≥80%；季度复审，过期标识与更新提醒；
- 一键转知识：从工单自动带入字段与上下文。

### B3. 设计检查清单（按应用域）
- 域：摇杆、滚轮、踏板、方向盘/换挡、座椅、BLDC 位置等；
- 维度：磁路（磁材/充磁方式/尺寸/气隙/对准）、传感器（轴向/饱和/灵敏度）、硬件（供电/接口/滤波/ESD/EMC）、固件（采样率/校准/诊断）、环境（温度/振动/老化）、安规/车规；
- 产物：PDF 报告（含签名、时间戳、项目编号）。

### B4. 参考设计库
- 内容：磁路+器件+固件参数卡片（含 BOM、关键尺寸、推荐阈值、已知风险/边界）；
- 复用：一键复制为项目草稿；关联项目与知识。

### B5. 仪表盘（基础）
- 卡片：MA‑DI、首响时长 P50/P90、解决时长 P50/P90、工单→知识转化率、检查清单“通过”次数/项目、参考设计复用次数、TopN；
- 维度：时间、地区、客户、应用域、产品系列。

### B6. 集成（MVP）
- 企业微信：机器人消息卡片推送；
- CRM（只读）：账户/项目映射、阶段与活动只读同步；
- 邮件入库（可选）：支持转发到专用地址生成工单。

## C. 数据模型与“Design‑in”口径
### C1. 核心实体
- **Account**（客户/地区/行业）
- **Project（Design‑in）**：`project_id`、`account_id`、`product_series`、`application_domain`、`stage`、`stage_updated_at`、`owners`（sales/fae/pm）、`risk_level`、`crm_ref`；
- **Ticket**：`ticket_id`、`project_id?`、`type`、`severity`、`status`、`created_by`、`first_response_at`、`resolved_at`；
- **KnowledgeArticle**：模板字段+`review_status`、`next_review_at`；
- **ChecklistRun**：`project_id`、`domain`、项级结果、`passed`、导出记录；
- **RefDesign**：卡片字段、版本、复用计数；
- **User**：角色/权限；
- **Dictionary**：枚举/口径版本（见附录）。

### C2. Design‑in 阶段状态机（V1）
- `Discovery → Engage → Sample → EVT → DVT → PVT → MP（Closed Won）`
- 终止：`Lost`、`On‑hold`（不计入活跃）。

### C3. “有效活动”定义（用于 MA‑DI 计算）
- 下列任一事件在**当月**发生：`ticket_created` / `ticket_first_response` / `ticket_resolved` / `checklist_run_passed` / `knowledge_published` / `project_stage_changed` / `refdesign_reused`。

### C4. 关键枚举（节选）
- `application_domain`：Joystick / Mouse Wheel / Pedal / Steering / Shifter / Seat / BLDC Position / Other；
- `product_series`：KTH55xx / KTH57xx / KTH579x / Other；
- `interface`：I2C / SPI / PWM / ABZ / SENT；
- `magnetization`：Radial / Axial / Diametral；
- 详见附录。

## D. 指标与仪表盘（可观测化）
### D1. 指标定义
- **NSM：MA‑DI** = 当月 `Project` 处于活跃阶段且有“有效活动”的去重项目数；
- **首响时长（h）** = `first_response_at - ticket.created_at` 的分位数（P50/P90）；
- **解决时长（h）** = `resolved_at - ticket.created_at` 分位数；
- **转化率** = `工单→知识` 的通过发布占比；
- **Checklist 通过次数/项目** = 当月 `passed=true` 的 `ChecklistRun` 计数；
- **参考设计复用次数** = `refdesign_reused` 事件当月计数。

### D2. 看板实现
- 日/周离线任务产出宽表；卡片支持维度筛选与导出；
- 计算口径版本化，随 `Dictionary.version` 存档。

## E. 集成策略（MVP 收敛）
- **企业微信**：Webhook 卡片；
- **CRM 只读**：按 `account_id`/`project_id` 映射阶段和基本档案；
- **其余集成（JIRA/ERP/双向 CRM）**：V2 评估。

## F. 非功能需求（SLA/安全/运维）
- **性能**：P95<200ms（主要读）、并发 200+（试点容量）；
- **可用性**：≥99.5%/月；备份每日；
- **安全**：角色/租户隔离、字段级权限（客户信息/价格等）；
- **部署**：V1 交付 Docker Compose（单机），提供镜像与样例 `docker-compose.yml`；K8s 作为 V2 选项；
- **日志与审计**：访问、变更、导出记录；
- **合规**：客户数据脱敏导出、按需匿名化训练样本。

## G. 埋点与事件（V1 必做）
- 事件：`ticket_created`、`ticket_first_response`、`ticket_resolved`、`knowledge_published`、`checklist_run_started/finished`、`checklist_run_passed`、`refdesign_reused`、`project_stage_changed`；
- 公共属性：`user_id`、`role`、`account_id?`、`project_id?`、`application_domain`、`product_series`、`ts`；
- 事件落盘→离线聚合→仪表盘。

## H. 交付物与验收标准（V1）
- **功能验收**：
  - F‑01 工单最小闭环；
  - F‑02 知识库强模板与评审流；
  - F‑03 检查清单覆盖 5 个应用域，报告可导出；
  - F‑04 参考设计库可被复用并可追踪；
  - F‑05 企业微信通知可达；CRM 只读同步生效；
  - F‑06 仪表盘展示 NSM 与 5 项驱动指标。
- **数据与口径验收**：
  - D‑01 `Dictionary` 与枚举冻结并可追溯；
  - D‑02 MA‑DI 计算与事件回放一致；
  - D‑03 导出报告与看板数据一致性抽检通过≥98%。
- **非功能验收**：
  - N‑01 压测报告（并发×接口×P95）；
  - N‑02 审计日志开启；
  - N‑03 备份/恢复演练通过。

## I. 推广与运营计划
- 上线培训（销售/FAE/PM），发布“周榜”：最快首响、最佳知识、参考设计复用冠军；
- 每周运营例会复盘指标与案例；
- 季度知识复审与清理。

## J. V2 展望与进入门槛
- **磁路仿真**：进入门槛 = 精度基准（与台架测量误差 ≤±X%）、单案计算时延 ≤Y s、并发容量≥Z；
- **深度集成**：CRM 双向/ERP/JIRA；
- **自动化工作流**：基于规则的路由/升级；
- **竞品情报中心**：结构化字段+来源与更新频率。

---

<a id="appendix"></a>
# 附录：模板与枚举

## 附录 A：知识模板（V1）
- 标题 / 标签 / 版本 / 时间戳  
- 【问题现象】  
- 【根因分析】  
- 【实验条件与数据】(含环境、设备、波形/图表)  
- 【修复/参数建议】(含寄存器/阈值/流程)  
- 【适用范围与限制】(产品系列/应用域/固件版本)  
- 【失败模式（FMEA）】  
- 【脚本/参考代码】(附件)  
- 作者 / 评审 / 发布人  
- 关联：工单 / 项目 / 参考设计

## 附录 B：设计检查清单结构（示例：摇杆域）
- 磁路：磁材、充磁（径向/轴向/直径向）、尺寸、气隙、对准、磁场目标（mT）；
- 传感器：安装姿态、XY 匹配、饱和/线性区、增益与偏置；
- 硬件：供电、滤波、接口（I2C/SPI/PWM/ABZ/SENT）、ESD/EMC；
- 固件：采样率、角度解算、校准流程、诊断上报；
- 环境：温度/振动/寿命；
- 报告：结论、风险、建议与签名。

## 附录 C：参考设计卡片字段
- 应用域 / 目标指标 / 磁路配置 / 传感器与固件参数 / 原理图与 PCB 尺寸 / BOM / 已知风险 / 适用范围 / 版本与时间戳。

## 附录 D：枚举与数据词典（节选）
- `application_domain`：Joystick / Mouse Wheel / Pedal / Steering / Shifter / Seat / BLDC Position / Other；
- `product_series`：KTH55xx / KTH57xx / KTH579x / Other；
- `problem_type`：性能/精度/噪声/温飘/通信/I2C/SPI/PWM/ABZ/ESD/EMC/机械/磁路/固件/量产/其他；
- `severity`：S1 阻塞 / S2 重大 / S3 一般 / S4 咨询；
- `stage`：Discovery / Engage / Sample / EVT / DVT / PVT / MP / Lost / On‑hold；
- `magnetization`：Radial / Axial / Diametral；
- `interface`：I2C / SPI / PWM / ABZ / SENT；
- `region`：CN/EU/US/APAC/Other；
- `dictionary.version`：v1.0（冻结于上线日）。

---

> 注：本稿为对齐后的 V1 草案。若需，我可继续：
> 1) 生成 `docker-compose.yml` 与示例埋点 JSON Schema；
> 2) 输出 5 个应用域的“检查清单题库”初稿；
> 3) 产出 KPI 大盘的离线数仓脚本样例。

---
## AI 与 Agent 扩展方案（增强智能与交互性）

### 1. 智能能力（5 类）
1) **检索问答（RAG）**  
   - 双语检索；BM25 + 向量 + 知识图谱混合召回；  
   - **“CITE or FAIL”**：必须带来源卡片（知识条目/工单/参考设计/检查清单），否则改为澄清提问；  
   - 结构化抽取：自动抽取产品系列/应用域/接口/磁化方式/温区等字段用于过滤。

2) **内容共创（Author Assist）**  
   - 一键把工单转为强模板知识：现象→根因→实验→对策→适用范围→FMEA 摘要→脚本；  
   - 质量自检：格式/术语/敏感信息扫描，图片/波形自动标注；  
   - 多版本对比与合并建议。

3) **智能路由与去重（Triage & De-dup）**  
   - 新工单：相似案例匹配、重复合并建议；  
   - 推荐对应**设计检查清单**与**参考设计**；  
   - 风险识别：按问题类型/严重度自动升级，给出**可执行检查步骤**。

4) **知识治理（Librarian）**  
   - 实体抽取与自动标签（产品系列/应用域/接口/磁化方式/封装/温区/寄存器）；  
   - 过期提醒、冲突检测（阈值冲突/多版本漂移），自动生成修订 PR；  
   - 周期性“知识健康度”报告（覆盖度、复用率、死链、口径一致性）。

5) **工具化协作（Toolformer）**  
   - 调用工具：寄存器校验器、磁路规则校验器（非仿真）、BOM 规范校验器、报告导出器；  
   - 代码/脚本助手：自动给出 Python/STM32 HAL 示例与参数脚本，并与“参考设计卡片”联动。

### 2. Agent 编队（可控可观测）
- **前门对话 Copilot（Router）**：意图识别→路由到检索/清单/参考设计/规则校验/创建草稿；  
- **FAE Copilot（Triage Agent）**：盯新工单、去重、推荐清单/参考设计、设置首响倒计时；  
- **知识馆员（Librarian Agent）**：审稿前自检、实体/标签补全、冲突/重复提示、季度复审催办；  
- **规则校验官（Rule-Check Agent）**：调用“磁路/接口/寄存器”**确定性规则**校验，产出执行步骤；  
- **数据观测员（Metrics Agent）**：把对话/工具调用转埋点，保证 NSM 与驱动指标可复算。

> 原则：**生成≠发布**。所有会影响知识库的变更走“草稿→审阅→发布”；S1/S2 场景仅给“检查步骤+引用”，不直接给定论。

### 3. 体系架构（落地视角）
- **索引层**：文档分块（1–2k tokens，保留表格/图题），双语向量（如 BGE-M3 / E5-Mistral），BM25 倒排，知识图谱（实体：产品系列/应用域/接口/磁化方式/封装/温区/寄存器）。  
- **检索编排**：关键词/图谱过滤→向量召回→交叉重排（cross-encoder）→规则过滤（仅“已发布/未过期”）→答案生成（带引用）。  
- **工具层（函数调用）**：`kb.search()` / `kb.get_article()` / `kb.create_draft()` / `checklist.generate()` / `rules.validate()` / `report.export()`  
- **观测与治理**：所有智能动作日志化+埋点；“缺引用/校验失败”硬告警；指标口径版本化。

### 4. 质量与安全
- **防幻觉**：无引用不答；数值/寄存器/阈值类结论需通过规则校验器二次确认；  
- **保密**：索引前脱敏；租户与字段级权限；导出/分享留审计；  
- **评测**：200 道黄金集周回归（命中率、引用完整度、可执行性、首响时长变化）；  
- **人机共管**：AI 草稿标注 “AI‑assisted”，默认 Owner 为 Librarian。

### 5. 与 V1 对齐
- **工单→知识**：AI 草稿+自检，人审发布；  
- **设计检查清单**：智能推荐必查项与风险，导出标准 PDF；  
- **参考设计库**：回答内可嵌入“可复用卡片”，并记录**复用事件**；  
- **仪表盘**：问答/工具调用事件打通，驱动 NSM 与 I1~I4。

### 6. 上线节奏（4 周）
- 第1周：最小 RAG（已发布知识/参考设计/检查清单）+ “CITE or FAIL”；  
- 第2周：接工单做 Triage（去重/相似推荐/清单推荐）；  
- 第3周：Author Assist 草稿→人审→发布；加入规则校验器；  
- 第4周：Librarian 周任务（过期/冲突/质量报表）；埋点接仪表盘。

### 7. 衡量是否“更聪明”
- **回答可用率** ≥85%；**首响时长** ↓≥20%；**工单→知识转化率** ↑≥15%；  
- **参考设计复用次数/月** ↑≥30%；**知识健康度**（过期↓、重复↓、一次通过率↑）。

### 8. 函数清单（示例）
```json
{
  "kb.search": {"q": "霍尔 摇杆 PWM 抖动", "filters": {"domain":"Joystick","status":"published"}, "top_k": 5},
  "kb.create_draft": {"template":"knowledge.v1","fields": {"title":"...","phenomenon":"...","root_cause":"..."}, "source_ticket":"TCK-2025-081"},
  "checklist.generate": {"domain":"Joystick","params":{"sensor":"KTH57xx","magnetization":"Radial"}},
  "rules.validate": {"type":"magnet_rules","payload":{"gap_mm":1.2,"sensor":"KTH5791","axis":"X"}},
  "report.export": {"type":"checklist_pdf","project_id":"PRJ-001","run_id":"RUN-0731"}
}
```
